# 🎯 대댓글 기능 설치 가이드

## 📋 개요
피드 게시물의 댓글에 대댓글(답글) 기능이 추가되었습니다.

## ✅ 변경된 파일 목록

### 1. 데이터베이스 스키마
- `sql/ADD_REPLY_TO_COMMENTS.sql` (신규 생성)

### 2. CSS 스타일
- `css/feed.css` (대댓글 스타일 추가)
- `css/artwork.css` (대댓글 스타일 추가)

### 3. JavaScript 로직
- `js/artwork.js` (대댓글 렌더링 및 작성 로직 추가)

### 4. 문서
- `프로젝트 구조/ARCHITECTURE.md` (업데이트)
- `대댓글_기능_설치_가이드.md` (신규 생성)

## 🚀 설치 방법

### 1단계: 데이터베이스 업데이트

1. Supabase 대시보드에 접속합니다.
2. 왼쪽 메뉴에서 **"SQL Editor"**를 클릭합니다.
3. `sql/ADD_REPLY_TO_COMMENTS.sql` 파일의 내용을 복사합니다.
4. SQL Editor에 붙여넣고 **"Run"** 버튼을 클릭합니다.

이 작업으로 다음이 추가됩니다:
- `artwork_comments` 테이블에 `parent_comment_id` 컬럼 추가
- 대댓글 조회를 위한 인덱스 생성
- 대댓글 수 집계 함수 생성

### 2단계: 파일 배포

모든 변경된 파일들이 이미 저장되어 있으므로, 서버를 재시작하면 바로 적용됩니다.

```bash
python server.py
```

## 🎨 기능 설명

### 사용자 경험

1. **댓글 보기**
   - 부모 댓글과 대댓글이 계층적으로 표시됩니다.
   - 대댓글은 들여쓰기와 왼쪽 테두리로 구분됩니다.

2. **답글 달기**
   - 각 댓글에 "답글 달기" 버튼이 표시됩니다.
   - 버튼 클릭 시 해당 댓글 아래에 답글 입력 폼이 나타납니다.
   - 답글 입력 폼에는 "@작성자명"이 표시됩니다.

3. **답글 작성**
   - 답글 내용을 입력하고 "게시" 버튼을 클릭합니다.
   - 작성된 답글은 부모 댓글 아래에 들여쓰기되어 표시됩니다.

4. **답글 삭제**
   - 본인이 작성한 답글만 삭제할 수 있습니다.
   - 삭제 버튼은 본인의 답글에만 표시됩니다.

### 기술적 구조

#### 데이터베이스 스키마
```sql
artwork_comments 테이블:
- id: 댓글 고유 ID
- artwork_id: 작품 ID
- user_id: 작성자 ID
- content: 댓글 내용
- parent_comment_id: 부모 댓글 ID (대댓글인 경우)
- author_nickname: 작성자 닉네임
- created_at: 작성 시간
```

#### 렌더링 로직
1. 댓글을 부모 댓글과 대댓글로 분류
2. 부모 댓글 먼저 렌더링
3. 각 부모 댓글 아래에 해당하는 대댓글들을 렌더링
4. 대댓글에는 "@부모댓글작성자" 표시

#### 주요 함수
- `renderArtworkComments()`: 댓글 및 대댓글 렌더링
- `submitArtworkComment(artworkId, parentCommentId)`: 댓글/대댓글 작성
- `showArtworkReplyForm()`: 대댓글 입력 폼 표시
- `hideArtworkReplyForm()`: 대댓글 입력 폼 숨기기

## 🎯 UI/UX 특징

### 시각적 구분
- **부모 댓글**: 일반 배경색 (var(--bg))
- **대댓글**: 흰색 배경 + 왼쪽 테두리 (2px solid var(--border))
- **들여쓰기**: 42px 왼쪽 마진

### 인터랙션
- **답글 달기 버튼**: 파란색 (var(--primary))
- **답글 입력 폼**: 연한 배경 + 왼쪽 파란 테두리
- **취소 버튼**: 답글 입력 폼 닫기

### 반응형
- 모바일에서도 동일한 계층 구조 유지
- 작은 화면에서는 들여쓰기가 자동으로 조정됨

## 🔍 테스트 방법

1. **기본 댓글 작성 테스트**
   - 작품 상세보기 모달 열기
   - 댓글 입력 후 "게시" 클릭
   - 댓글이 정상적으로 표시되는지 확인

2. **답글 작성 테스트**
   - 댓글의 "답글 달기" 버튼 클릭
   - 답글 입력 폼이 나타나는지 확인
   - 답글 작성 후 "게시" 클릭
   - 답글이 부모 댓글 아래에 들여쓰기되어 표시되는지 확인

3. **답글 삭제 테스트**
   - 본인이 작성한 답글의 "삭제" 버튼 클릭
   - 삭제 확인 후 답글이 사라지는지 확인

4. **다중 답글 테스트**
   - 하나의 댓글에 여러 답글 작성
   - 모든 답글이 올바르게 표시되는지 확인

5. **취소 기능 테스트**
   - "답글 달기" 클릭 후 "취소" 버튼 클릭
   - 답글 입력 폼이 사라지는지 확인

## 📝 주의사항

1. **데이터베이스 마이그레이션 필수**
   - `ADD_REPLY_TO_COMMENTS.sql`을 반드시 실행해야 합니다.
   - 실행하지 않으면 대댓글 기능이 작동하지 않습니다.

2. **기존 댓글 호환성**
   - 기존 댓글들은 자동으로 부모 댓글로 처리됩니다.
   - `parent_comment_id`가 NULL인 댓글은 부모 댓글입니다.

3. **대댓글의 대댓글**
   - 현재 구조는 1단계 대댓글만 지원합니다.
   - 대댓글에 대한 답글은 동일한 부모 댓글의 대댓글로 추가됩니다.

## 🐛 문제 해결

### 대댓글이 표시되지 않는 경우
1. 데이터베이스 마이그레이션이 완료되었는지 확인
2. 브라우저 캐시를 지우고 새로고침
3. 개발자 도구 콘솔에서 에러 메시지 확인

### 답글 달기 버튼이 작동하지 않는 경우
1. 로그인 상태 확인
2. JavaScript 파일이 올바르게 로드되었는지 확인
3. 브라우저 콘솔에서 에러 확인

### 스타일이 깨지는 경우
1. CSS 파일이 올바르게 로드되었는지 확인
2. 브라우저 캐시 삭제
3. CSS 파일의 문법 오류 확인

## 📚 추가 개발 가능 기능

1. **대댓글 알림**
   - 누군가 내 댓글에 답글을 달면 알림 표시

2. **대댓글 수 표시**
   - 각 댓글에 답글 개수 표시

3. **대댓글 접기/펼치기**
   - 답글이 많은 경우 접기/펼치기 기능

4. **멘션 기능**
   - @사용자명 자동 완성 기능

5. **대댓글 정렬**
   - 최신순/오래된순 정렬 옵션

## ✅ 완료!

대댓글 기능이 성공적으로 추가되었습니다. 
사용자들은 이제 댓글에 답글을 달아 더 활발한 소통을 할 수 있습니다.
