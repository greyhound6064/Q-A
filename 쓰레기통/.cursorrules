# Cursor AI 개발 규칙

## 프로젝트 개요
바이브 코딩 결과물을 공유하는 소셜 미디어 웹앱

## 기술 스택
- **Frontend**: Vanilla JS (ES6 모듈), HTML5, CSS3
- **Backend**: Supabase (인증, DB, Storage)
- **데이터베이스**: PostgreSQL (Supabase)

## 📁 파일 구조 규칙

### JavaScript 모듈
- **auth.js**: 모든 인증 관련 기능 (로그인, 로그아웃)
- **profile.js**: 프로필 조회/수정
- **artwork.js**: 작품 조회/삭제
- **upload.js**: 작품 업로드
- **edit.js**: 작품 수정
- **carousel.js**: 캐러셀 공통 로직
- **tabs.js**: 탭 전환
- **posts.js**: 커뮤니티 게시물 (레거시)
- **utils.js**: 유틸리티 함수

### CSS 파일 (권장 분리)
- **base.css**: CSS 변수, 리셋
- **layout.css**: 레이아웃, 그리드
- **components.css**: 버튼, 모달, 폼
- **profile.css**: 프로필 페이지
- **artwork.css**: 작품 그리드, 상세보기
- **upload.css**: 업로드/수정 모달

## 🎯 파일 수정 원칙

### 기능별 파일 매핑
- **인증 기능 수정** → `js/auth.js`만 수정
- **프로필 기능 수정** → `js/profile.js`만 수정
- **작품 조회/삭제** → `js/artwork.js` 수정
- **작품 업로드** → `js/upload.js` 수정
- **작품 수정** → `js/edit.js` 수정
- **스타일 수정** → 해당 CSS 파일만 수정

### 수정 전 확인사항
1. `PROJECT_STRUCTURE.md` 파일에서 관련 파일 위치 확인
2. 해당 파일만 수정 (다른 파일에 영향 최소화)
3. 변경사항이 다른 기능에 영향 없는지 확인

## 📝 코딩 규칙

### 1. 함수 명명 규칙
```javascript
// 모달 관련
open{Name}Modal()      // 모달 열기
close{Name}Modal()     // 모달 닫기

// 데이터 관련
render{Name}()         // 데이터 렌더링
save{Name}()          // 데이터 저장
update{Name}()        // 데이터 업데이트
delete{Name}()        // 데이터 삭제

// 이벤트 관련
handle{Action}()      // 이벤트 핸들러
on{Event}()           // 이벤트 리스너
```

### 2. 전역 함수 등록
```javascript
// 각 모듈에서 필요한 함수만 window에 등록
// HTML onclick 속성에서 사용할 함수만 등록
window.functionName = functionName;
```

### 3. Supabase 사용
```javascript
// 항상 _supabase 변수 사용
const { data, error } = await _supabase
    .from('table_name')
    .select('*');

// 에러 처리 필수
if (error) {
    console.error('에러:', error);
    alert('사용자 친화적 메시지');
    return;
}
```

### 4. 에러 처리 패턴
```javascript
try {
    // 작업 시작 로그
    console.log('작업 시작:', details);
    
    // 작업 수행
    const result = await performTask();
    
    // 성공 로그
    console.log('작업 완료:', result);
    
    // 사용자 피드백
    alert('작업이 완료되었습니다!');
    
} catch (err) {
    // 에러 로그
    console.error('에러 발생:', err);
    
    // 사용자 친화적 에러 메시지
    alert('작업 중 오류가 발생했습니다: ' + err.message);
}
```

### 5. 비동기 함수 패턴
```javascript
async function functionName() {
    // 로딩 상태 시작
    if (btn) {
        btn.disabled = true;
        btn.textContent = '처리 중...';
    }
    
    try {
        // 작업 수행
        const result = await someAsyncTask();
        
        // 성공 처리
        return result;
        
    } catch (err) {
        // 에러 처리
        console.error('에러:', err);
        throw err;
        
    } finally {
        // 로딩 상태 종료
        if (btn) {
            btn.disabled = false;
            btn.textContent = '원래 텍스트';
        }
    }
}
```

## 🗄️ 데이터베이스 스키마

### profiles 테이블
```sql
- id: uuid (PK)
- user_id: uuid (FK → auth.users)
- nickname: text
- bio: text
- avatar_url: text
- created_at: timestamp
- updated_at: timestamp
```

### artworks 테이블
```sql
- id: uuid (PK)
- user_id: uuid (FK → auth.users)
- title: text
- description: text
- image_url: text (첫 번째 이미지)
- images: text[] (다중 이미지 배열)
- author_nickname: text
- author_email: text
- created_at: timestamp
- updated_at: timestamp
```

## 🎨 스타일 가이드

### CSS 변수 사용
```css
/* 항상 CSS 변수 사용 */
color: var(--primary);
background: var(--card-bg);
border: 1px solid var(--border);

/* 직접 색상 코드 사용 금지 */
/* color: #2563eb; ❌ */
```

### 반응형 디자인
```css
/* 모바일 우선 */
.element {
    /* 기본 스타일 (모바일) */
}

@media (min-width: 768px) {
    .element {
        /* 태블릿 스타일 */
    }
}

@media (min-width: 1024px) {
    .element {
        /* 데스크톱 스타일 */
    }
}
```

## 🚀 개발 워크플로우

### 새 기능 추가 시
1. **기능 설계**
   - 어떤 기능을 추가할지 명확히 정의
   - UI/UX 스케치

2. **파일 확인**
   - `PROJECT_STRUCTURE.md` 참조
   - 관련 파일 위치 확인

3. **코드 작성**
   - 해당 JS 파일에 함수 추가
   - 주석으로 함수 설명 작성

4. **스타일 추가**
   - 해당 CSS 파일에 스타일 추가
   - 기존 스타일과 일관성 유지

5. **HTML 수정**
   - `index.html`에 필요한 HTML 추가
   - 시맨틱 HTML 사용

6. **테스트**
   - 브라우저에서 기능 테스트
   - 다양한 화면 크기에서 테스트

7. **문서화**
   - `PROJECT_STRUCTURE.md` 업데이트
   - 주요 변경사항 기록

### 버그 수정 시
1. **문제 파악**
   - 어떤 파일에서 문제가 발생하는지 확인
   - 콘솔 로그 확인

2. **파일 확인**
   - `PROJECT_STRUCTURE.md`에서 관련 파일 찾기
   - 해당 파일만 열기

3. **수정**
   - 최소한의 변경으로 문제 해결
   - 다른 기능에 영향 없는지 확인

4. **테스트**
   - 수정한 기능 테스트
   - 관련 기능도 테스트

## 📋 체크리스트

### 코드 작성 전
- [ ] `PROJECT_STRUCTURE.md` 확인
- [ ] 어떤 파일을 수정해야 하는지 파악
- [ ] 기존 코드 스타일 확인

### 코드 작성 중
- [ ] 함수 명명 규칙 준수
- [ ] 에러 처리 추가
- [ ] 로딩 상태 관리
- [ ] 콘솔 로그 추가 (디버깅용)

### 코드 작성 후
- [ ] 브라우저에서 테스트
- [ ] 콘솔 에러 확인
- [ ] 다른 기능 영향 확인
- [ ] 불필요한 콘솔 로그 제거

## 🎯 응답 규칙

### 사용자 명령 이해
```
사용자: "프로필 수정 기능에 이메일 변경 추가해줘"
→ Cursor: profile.js 파일 열고 수정

사용자: "작품 그리드에 좋아요 수 표시해줘"
→ Cursor: artwork.js, artwork.css 수정

사용자: "업로드 모달 디자인 개선해줘"
→ Cursor: upload.css 수정

사용자: "로그인 실패 시 에러 메시지 개선해줘"
→ Cursor: auth.js 수정
```

### 응답 형식
1. **파일 확인** - 어떤 파일을 수정할지 명시
2. **변경 내용** - 무엇을 변경할지 설명
3. **코드 수정** - 실제 코드 수정
4. **테스트 가이드** - 어떻게 테스트할지 안내

### 금지 사항
- ❌ 여러 파일을 동시에 대량 수정
- ❌ 파일 구조 확인 없이 추측으로 수정
- ❌ 에러 처리 없는 코드 작성
- ❌ 사용자에게 불필요한 기술 용어 사용

### 권장 사항
- ✅ 한 번에 하나의 파일만 수정
- ✅ `PROJECT_STRUCTURE.md` 항상 참조
- ✅ 변경사항 최소화
- ✅ 명확하고 간결한 설명

## 🔧 디버깅 가이드

### 콘솔 로그 패턴
```javascript
// 함수 시작
console.log('functionName 호출됨');

// 중요 변수
console.log('변수명:', value);

// API 호출 전
console.log('API 호출:', endpoint, params);

// API 호출 후
console.log('API 응답:', data);

// 에러
console.error('에러 발생:', error);
```

### 자주 발생하는 문제

#### 1. Supabase 연결 실패
```javascript
// 확인사항
- supabase-config.js 로드 확인
- _supabase 변수 존재 확인
- 네트워크 연결 확인
```

#### 2. 스키마 캐시 문제
```sql
-- 해결방법
NOTIFY pgrst, 'reload schema';
```

#### 3. 이미지 업로드 실패
```javascript
// 확인사항
- 파일 크기 (10MB 이하)
- 파일 타입 (image/*)
- Storage 버킷 존재 확인
- RLS 정책 확인
```

## 📚 참고 자료

### 주요 문서
- `PROJECT_STRUCTURE.md` - 전체 프로젝트 구조
- `SETUP_DATABASE.sql` - 데이터베이스 초기 설정
- `SETUP_ARTWORKS_TABLE.sql` - 작품 테이블 설정
- `FIX_IMAGES_COLUMN.sql` - 다중 이미지 컬럼 추가

### 외부 링크
- Supabase 문서: https://supabase.com/docs
- JavaScript ES6 모듈: https://developer.mozilla.org/ko/docs/Web/JavaScript/Guide/Modules

---

**중요**: 항상 `PROJECT_STRUCTURE.md`를 먼저 확인하고 작업을 시작하세요!
