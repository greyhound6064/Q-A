# ğŸ·ï¸ íƒœê·¸ ì‚¬ìš© íšŸìˆ˜ ìë™ ê´€ë¦¬ ì‹œìŠ¤í…œ

## ğŸ“‹ ê°œìš”
`tags.usage_count`ë¥¼ DB íŠ¸ë¦¬ê±°ë¡œ ìë™ ê´€ë¦¬í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

## ğŸ”¥ ë¬¸ì œì  (íŠ¸ë¦¬ê±° ë„ì… ì „)
- **ë™ì‹œì„± ë¬¸ì œ**: ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì‹œì— ë°œìƒ ì‹œ ê°±ì‹  ë¶„ì‹¤(Lost Update)
- **ì›ìì„± ë¶€ì¡±**: ì—°ê²°(INSERT)ê³¼ ì¹´ìš´íŠ¸ ì¦ê°€(UPDATE)ê°€ ë¶„ë¦¬ë˜ì–´ ë¶ˆì¼ì¹˜ ë°œìƒ
- **ì½”ë“œ ë³µì¡ë„**: ëª¨ë“  íŒŒì¼ì—ì„œ usage_countë¥¼ ìˆ˜ë™ìœ¼ë¡œ ê´€ë¦¬

## âœ… í•´ê²°ì±… (íŠ¸ë¦¬ê±° ë„ì… í›„)
- **ìë™ ê´€ë¦¬**: artwork_tags INSERT/DELETE ì‹œ ìë™ìœ¼ë¡œ usage_count ì¦ê°€/ê°ì†Œ
- **ì›ìì„± ë³´ì¥**: DB ë ˆë²¨ì—ì„œ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬
- **ì½”ë“œ ë‹¨ìˆœí™”**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì—ì„œ usage_count ê´€ë¦¬ ë¶ˆí•„ìš”

---

## ğŸš€ ì„¤ì¹˜ ë°©ë²•

### 1ë‹¨ê³„: Supabase SQL Editorì—ì„œ íŠ¸ë¦¬ê±° ìƒì„±
1. Supabase ëŒ€ì‹œë³´ë“œ ì ‘ì†
2. SQL Editor ë©”ë‰´ ì„ íƒ
3. `triggers_tag_usage_count.sql` íŒŒì¼ ë‚´ìš© ë³µì‚¬
4. ì‹¤í–‰ (Run)

### 2ë‹¨ê³„: ê¸°ì¡´ ë°ì´í„° ì¬ê³„ì‚°
ë¸Œë¼ìš°ì € ê°œë°œì ì½˜ì†”(F12)ì—ì„œ:
```javascript
await recalculateAllTagCounts()
```

### 3ë‹¨ê³„: í™•ì¸
```javascript
await checkAllTags()  // ëª¨ë“  íƒœê·¸ ìƒíƒœ í™•ì¸
await debugTag('íƒœê·¸ì´ë¦„')  // íŠ¹ì • íƒœê·¸ í™•ì¸
```

---

## ğŸ“Š íŠ¸ë¦¬ê±° ë™ì‘ ë°©ì‹

### INSERT íŠ¸ë¦¬ê±°
```
artwork_tagsì— ìƒˆ í–‰ ì¶”ê°€
  â†“
íŠ¸ë¦¬ê±° ìë™ ì‹¤í–‰
  â†“
tags.usage_count += 1
```

### DELETE íŠ¸ë¦¬ê±°
```
artwork_tagsì—ì„œ í–‰ ì‚­ì œ
  â†“
íŠ¸ë¦¬ê±° ìë™ ì‹¤í–‰
  â†“
tags.usage_count -= 1 (ìµœì†Œê°’ 0)
```

---

## ğŸ” í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ìƒˆ ê²Œì‹œë¬¼ì— íƒœê·¸ ì¶”ê°€
```javascript
// ê²Œì‹œë¬¼ ì—…ë¡œë“œ ì‹œ #í…ŒìŠ¤íŠ¸ íƒœê·¸ ì¶”ê°€
// ìë™ìœ¼ë¡œ usage_countê°€ 1 ì¦ê°€
```

### 2. í™•ì¸
```javascript
await debugTag('í…ŒìŠ¤íŠ¸')
// ì‹¤ì œ ì—°ê²° ìˆ˜ì™€ usage_countê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
```

### 3. ê²Œì‹œë¬¼ ì‚­ì œ
```javascript
// ê²Œì‹œë¬¼ ì‚­ì œ
// ìë™ìœ¼ë¡œ usage_countê°€ 1 ê°ì†Œ
```

### 4. ì¬í™•ì¸
```javascript
await debugTag('í…ŒìŠ¤íŠ¸')
// usage_countê°€ ì •í™•íˆ ê°ì†Œí–ˆëŠ”ì§€ í™•ì¸
```

---

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### íŠ¸ë¦¬ê±°ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°
1. SQL Editorì—ì„œ íŠ¸ë¦¬ê±° ìƒì„± í™•ì¸:
```sql
SELECT * FROM pg_trigger WHERE tgname LIKE 'trigger_%tag_usage%';
```

2. í•¨ìˆ˜ ì¡´ì¬ í™•ì¸:
```sql
SELECT * FROM pg_proc WHERE proname LIKE '%tag_usage_count%';
```

### ê¸°ì¡´ ë°ì´í„° ë¶ˆì¼ì¹˜
```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì¬ê³„ì‚°
await recalculateAllTagCounts()
```

---

## ğŸ“ ì½”ë“œ ë³€ê²½ ì‚¬í•­

### ë³€ê²½ ì „ (ìˆ˜ë™ ê´€ë¦¬)
```javascript
// íƒœê·¸ ì¶”ê°€ ì‹œ
await supabase.from('tags').update({ 
  usage_count: existingTag.usage_count + 1 
})

// íƒœê·¸ ì‚­ì œ ì‹œ
await supabase.from('tags').update({ 
  usage_count: existingTag.usage_count - 1 
})
```

### ë³€ê²½ í›„ (ìë™ ê´€ë¦¬)
```javascript
// artwork_tagsë§Œ ì¶”ê°€/ì‚­ì œí•˜ë©´ ë!
await supabase.from('artwork_tags').insert({ ... })
await supabase.from('artwork_tags').delete().eq(...)
// usage_countëŠ” íŠ¸ë¦¬ê±°ê°€ ìë™ ì²˜ë¦¬
```

---

## âœ¨ ì¥ì 

1. **ë°ì´í„° ì¼ê´€ì„± ë³´ì¥**: ë™ì‹œì„± ë¬¸ì œ ì™„ì „ í•´ê²°
2. **ì½”ë“œ ë‹¨ìˆœí™”**: 50ì¤„ ì´ìƒì˜ ë³µì¡í•œ ë¡œì§ ì œê±°
3. **ìœ ì§€ë³´ìˆ˜ ìš©ì´**: í•œ ê³³(DB)ì—ì„œë§Œ ê´€ë¦¬
4. **ì„±ëŠ¥ í–¥ìƒ**: ë¶ˆí•„ìš”í•œ SELECT/UPDATE ì¿¼ë¦¬ ê°ì†Œ
5. **ë²„ê·¸ ë°©ì§€**: ê°œë°œìê°€ ì‹¤ìˆ˜ë¡œ ì¹´ìš´íŠ¸ë¥¼ ë¹ ëœ¨ë¦´ ìœ„í—˜ ì œê±°

---

**ì‘ì„±ì¼**: 2026-01-29
**ë²„ì „**: 1.0.0
